# @package _global_
data:
  module:
    _target_: datasets.RSNA_Data.RSNA_DataModule
    name: RSNA
    data_root_dir: /home/jma/Documents/rsna/nnssl_dataset/nnssl_preprocessed/Dataset007_RSNA
    batch_size: 2
    use_weighted_sampling: False # to handle class imbalance (Default is True)
    train_transforms:
      _target_: augmentation.policies.batchgenerators.get_training_transforms
      patch_size: ${data.patch_size}
      rotation_for_DA: 0.523599
      mirror_axes: [0,1,2]
      do_dummy_2d_data_aug: False
    test_transforms: 
      _target_: augmentation.policies.batchgenerators.get_test_transforms
      patch_size: ${data.patch_size}
      do_dummy_2d_data_aug: False
  cv:
    k: 5

  num_classes: 2
  patch_size: [160, 160, 160]

model:
  # #------------------------#
  classification_head_type: timm # (Defaults is timm)
  # classification_head_type: alt         # <- use the new MLP head for this dataset
  # token_aggregation_method: null        # <- we're passing a (B, C) vector from ResEncoder
  # classification_head_dropout: 0.1      # optional: pre-MLP dropout (same field name as before)
  # # Only used by the alt head (safe to omit; shown here for clarity/tuning)
  # alt_mlp_dims: [256, 128, 64, 32]
  # alt_mlp_dropouts: [0.3, 0.3, 0.3, 0.2]
  # alt_use_logits_bn: true
  # #------------------------#
  task: 'Classification' #'Classification_Focal_Loss'
  subtask: 'multiclass' 
  cifar_size: False
  input_channels: 1
  input_dim: 3
  input_shape: ${data.patch_size}
  optimizer: AdamW
  lr: 0.0001
  warmstart: 20
  warmstart2: 20
  weight_decay: 1e-2
  finetune_method: full_sawtooth


trainer:
  logger:
    project: Kaggle RSNA - nnSSL Classification #project name for wandb
    name: RSNA_scratch_ResEnc_cls_DblWarmup_lr_1e-4_5folds_bsize4 #experiment name for wandb (but its overwritten by slurm script)
  accumulate_grad_batches: 48
  max_epochs: 300
  sync_batchnorm: True
  callbacks: 
    checkpoint:
      filename: 'epoch{epoch}-Val_loss={Val/loss:.2f}-Val_bal_acc={Val/Balanced_Accuracy:.2f}'
      mode: 'max'
      monitor: 'Val/Balanced_Accuracy'

metrics:
  # - 'mae' 
  # - 'mse'
  - 'f1'
  - 'balanced_acc'
  - 'ap'
  - 'auroc'